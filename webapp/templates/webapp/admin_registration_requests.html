{% extends 'webapp/modern-base.html' %}
{% load static %}

{% block title %}Pet Registration Requests - Admin{% endblock %}

{% block extra_head %}
<style>
  .admin-card { border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.06); }
  .stat-pill { padding: .5rem 1rem; border-radius: .5rem; background: var(--muted); }
  .approve-btn { background: #0ea5a4; color: white; border: none; padding: .4rem .75rem; border-radius: .35rem; }
  .reject-btn { background: #ef4444; color: white; border: none; padding: .4rem .75rem; border-radius: .35rem; }
  .muted-note { color: var(--muted-foreground); }
  .preview-image { max-width: 160px; max-height: 120px; object-fit: cover; border-radius: 8px; }
  .status-badge { padding: .35rem .75rem; border-radius: .5rem; }
  .status-approved { background: #e6fffa; color: #065f46; }
  .status-rejected { background: #ffe6e6; color: #7a0711; }
  .status-pending { background: #fff7ed; color: #7a4a00; }
  </style>
{% endblock %}

{% block content %}
<!-- TEMPLATE: admin_registration_requests.html - updated: 2025-10-07 14:35:00 -->

<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-12 col-lg-10">
      <div class="d-flex align-items-center mb-3">
        <h2 class="me-auto"><i class="fas fa-clipboard-check"></i> Pet Registration Requests </h2>
        <div class="stat-pill ms-2">Pending: {{ pending_requests.count }}</div>
        <div class="stat-pill ms-2">Total: {{ all_requests|length }}</div>
      </div>

      <div class="mb-4">
        <h5>Pending Requests</h5>
      </div>

      {% if pending_requests %}
        {% for request in pending_requests %}
          <div class="card admin-card mb-3">
            <div class="card-body">
              <div class="d-flex">
                <div class="flex-grow-1">
                  <h5>{{ request.name }}</h5>
                  <div class="muted-note">Submitted by {{ request.user.username }} &middot; {{ request.created_at|date:"M j, Y g:i A" }}</div>
                  <p class="mt-2">{{ request.description|default:'No description provided.' }}</p>
                  <div class="mt-2">
                    <form method="post" action="{% url 'webapp:approve_registration_request' request.id %}" class="d-inline-block me-2">
                      {% csrf_token %}
                      <input type="hidden" name="admin_notes" value="Approved via admin UI">
                      <button class="approve-btn">Approve</button>
                    </form>
                    <form method="post" action="{% url 'webapp:reject_registration_request' request.id %}" class="d-inline-block">
                      {% csrf_token %}
                      <input type="hidden" name="admin_notes" value="Rejected via admin UI">
                      <button class="reject-btn">Reject</button>
                    </form>
                  </div>
                </div>
                {% if request.image %}
                  <div class="ms-3">
                    <img src="{{ request.image.url }}" alt class="preview-image" />
                  </div>
                {% endif %}
              </div>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <div class="card p-4 text-center">
          <h4>No Pending Requests</h4>
          <p class="muted-note">All registration requests have been reviewed.</p>
        </div>
      {% endif %}

      <div class="mt-4"><h5>Recent Requests (Last 50)</h5></div>
      {% if all_requests %}
        {% for request in all_requests %}
          <div class="card admin-card mb-2">
            <div class="card-body d-flex justify-content-between align-items-center">
              <div>
                <strong>{{ request.name }}</strong>
                <div class="muted-note">{{ request.user.username }} &middot; {{ request.created_at|date:"M j, Y g:i A" }}</div>
              </div>
              <div>
                <span class="status-badge {% if request.status == 'approved' %}status-approved{% elif request.status == 'rejected' %}status-rejected{% else %}status-pending{% endif %}">{% if request.status == 'approved' %}Approved{% elif request.status == 'rejected' %}Rejected{% else %}Pending{% endif %}</span>
              </div>
            </div>
          </div>
        {% endfor %}
      {% endif %}
    </div>
  </div>
</div>

{% endblock %}